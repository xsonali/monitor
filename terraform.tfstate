{
  "version": 4,
  "terraform_version": "1.12.2",
  "serial": 19,
  "lineage": "43484c73-8604-30e0-a91c-44937871c999",
  "outputs": {},
  "resources": [
    {
      "mode": "data",
      "type": "azurerm_firewall",
      "name": "hub_fw",
      "provider": "provider[\"registry.terraform.io/hashicorp/azurerm\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "dns_proxy_enabled": false,
            "dns_servers": [],
            "firewall_policy_id": "/subscriptions/09624d5e-dd06-4d7b-9cd9-462e3f5416d0/resourceGroups/hub-vnet-rg-m617/providers/Microsoft.Network/firewallPolicies/hub-fw-policy",
            "id": "/subscriptions/09624d5e-dd06-4d7b-9cd9-462e3f5416d0/resourceGroups/hub-vnet-rg-m617/providers/Microsoft.Network/azureFirewalls/hub-fw",
            "ip_configuration": [
              {
                "name": "fw-configuration",
                "private_ip_address": "10.0.1.4",
                "public_ip_address_id": "/subscriptions/09624d5e-dd06-4d7b-9cd9-462e3f5416d0/resourceGroups/hub-vnet-rg-m617/providers/Microsoft.Network/publicIPAddresses/hub-fw-pip",
                "subnet_id": "/subscriptions/09624d5e-dd06-4d7b-9cd9-462e3f5416d0/resourceGroups/hub-vnet-rg-m617/providers/Microsoft.Network/virtualNetworks/hub-vnet/subnets/AzureFirewallSubnet"
              }
            ],
            "location": "australiaeast",
            "management_ip_configuration": [],
            "name": "hub-fw",
            "resource_group_name": "hub-vnet-rg-m617",
            "sku_name": "AZFW_VNet",
            "sku_tier": "Standard",
            "tags": {
              "createdBy": "terraform",
              "environment": "hub-vnet",
              "owner": "Gholam"
            },
            "threat_intel_mode": "Alert",
            "timeouts": null,
            "virtual_hub": [],
            "zones": []
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0
        }
      ]
    },
    {
      "mode": "data",
      "type": "azurerm_resource_group",
      "name": "hub_vnet_rg_m617",
      "provider": "provider[\"registry.terraform.io/hashicorp/azurerm\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "/subscriptions/09624d5e-dd06-4d7b-9cd9-462e3f5416d0/resourceGroups/hub-vnet-rg-m617",
            "location": "australiaeast",
            "managed_by": "",
            "name": "hub-vnet-rg-m617",
            "tags": {},
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0
        }
      ]
    },
    {
      "mode": "managed",
      "type": "azurerm_log_analytics_workspace",
      "name": "hub_logs",
      "provider": "provider[\"registry.terraform.io/hashicorp/azurerm\"]",
      "instances": [
        {
          "schema_version": 3,
          "attributes": {
            "allow_resource_only_permissions": true,
            "cmk_for_query_forced": false,
            "daily_quota_gb": -1,
            "data_collection_rule_id": "",
            "id": "/subscriptions/09624d5e-dd06-4d7b-9cd9-462e3f5416d0/resourceGroups/rg-hub-logs/providers/Microsoft.OperationalInsights/workspaces/hub-fw-logs",
            "identity": [],
            "immediate_data_purge_on_30_days_enabled": false,
            "internet_ingestion_enabled": true,
            "internet_query_enabled": true,
            "local_authentication_disabled": false,
            "location": "australiaeast",
            "name": "hub-fw-logs",
            "primary_shared_key": "RNlbI1diOpbn6FKvLikcb+6nC0iL6/TuW5IWBm8lTtsIn44owZH85ZJU/K91aWAl/1bIn0AzahpbUjPRXHgl1g==",
            "reservation_capacity_in_gb_per_day": null,
            "resource_group_name": "rg-hub-logs",
            "retention_in_days": 30,
            "secondary_shared_key": "B9yUx1MwqyL72Vftqf2J6GGZnAWeDfFuGnNuDmHFc9y18Tk9Jp6TQLUxots2CJfi6ZXLeL8M9b5btnxZGbnkEQ==",
            "sku": "PerGB2018",
            "tags": {
              "createdBy": "terraform",
              "environment": "hub-vnet",
              "owner": "Gholam"
            },
            "timeouts": null,
            "workspace_id": "5c218f7b-7ac8-45c0-b170-49561c8d58b7"
          },
          "sensitive_attributes": [
            [
              {
                "type": "get_attr",
                "value": "primary_shared_key"
              }
            ],
            [
              {
                "type": "get_attr",
                "value": "secondary_shared_key"
              }
            ]
          ],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxODAwMDAwMDAwMDAwLCJkZWxldGUiOjE4MDAwMDAwMDAwMDAsInJlYWQiOjMwMDAwMDAwMDAwMCwidXBkYXRlIjoxODAwMDAwMDAwMDAwfSwic2NoZW1hX3ZlcnNpb24iOiIzIn0=",
          "dependencies": [
            "azurerm_resource_group.rg_logs"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "azurerm_monitor_diagnostic_setting",
      "name": "fw_logs",
      "provider": "provider[\"registry.terraform.io/hashicorp/azurerm\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "enabled_log": [
              {
                "category": "AzureFirewallApplicationRule",
                "category_group": "",
                "retention_policy": [
                  {
                    "days": 0,
                    "enabled": false
                  }
                ]
              },
              {
                "category": "AzureFirewallDnsProxy",
                "category_group": "",
                "retention_policy": [
                  {
                    "days": 0,
                    "enabled": false
                  }
                ]
              },
              {
                "category": "AzureFirewallNetworkRule",
                "category_group": "",
                "retention_policy": [
                  {
                    "days": 0,
                    "enabled": false
                  }
                ]
              }
            ],
            "eventhub_authorization_rule_id": "",
            "eventhub_name": "",
            "id": "/subscriptions/09624d5e-dd06-4d7b-9cd9-462e3f5416d0/resourceGroups/hub-vnet-rg-m617/providers/Microsoft.Network/azureFirewalls/hub-fw|fw-diagnostics",
            "log": [
              {
                "category": "AZFWApplicationRule",
                "category_group": "",
                "enabled": false,
                "retention_policy": [
                  {
                    "days": 0,
                    "enabled": false
                  }
                ]
              },
              {
                "category": "AZFWApplicationRuleAggregation",
                "category_group": "",
                "enabled": false,
                "retention_policy": [
                  {
                    "days": 0,
                    "enabled": false
                  }
                ]
              },
              {
                "category": "AZFWDnsQuery",
                "category_group": "",
                "enabled": false,
                "retention_policy": [
                  {
                    "days": 0,
                    "enabled": false
                  }
                ]
              },
              {
                "category": "AZFWFatFlow",
                "category_group": "",
                "enabled": false,
                "retention_policy": [
                  {
                    "days": 0,
                    "enabled": false
                  }
                ]
              },
              {
                "category": "AZFWFlowTrace",
                "category_group": "",
                "enabled": false,
                "retention_policy": [
                  {
                    "days": 0,
                    "enabled": false
                  }
                ]
              },
              {
                "category": "AZFWFqdnResolveFailure",
                "category_group": "",
                "enabled": false,
                "retention_policy": [
                  {
                    "days": 0,
                    "enabled": false
                  }
                ]
              },
              {
                "category": "AZFWIdpsSignature",
                "category_group": "",
                "enabled": false,
                "retention_policy": [
                  {
                    "days": 0,
                    "enabled": false
                  }
                ]
              },
              {
                "category": "AZFWNatRule",
                "category_group": "",
                "enabled": false,
                "retention_policy": [
                  {
                    "days": 0,
                    "enabled": false
                  }
                ]
              },
              {
                "category": "AZFWNatRuleAggregation",
                "category_group": "",
                "enabled": false,
                "retention_policy": [
                  {
                    "days": 0,
                    "enabled": false
                  }
                ]
              },
              {
                "category": "AZFWNetworkRule",
                "category_group": "",
                "enabled": false,
                "retention_policy": [
                  {
                    "days": 0,
                    "enabled": false
                  }
                ]
              },
              {
                "category": "AZFWNetworkRuleAggregation",
                "category_group": "",
                "enabled": false,
                "retention_policy": [
                  {
                    "days": 0,
                    "enabled": false
                  }
                ]
              },
              {
                "category": "AZFWThreatIntel",
                "category_group": "",
                "enabled": false,
                "retention_policy": [
                  {
                    "days": 0,
                    "enabled": false
                  }
                ]
              },
              {
                "category": "AzureFirewallApplicationRule",
                "category_group": "",
                "enabled": true,
                "retention_policy": [
                  {
                    "days": 0,
                    "enabled": false
                  }
                ]
              },
              {
                "category": "AzureFirewallDnsProxy",
                "category_group": "",
                "enabled": true,
                "retention_policy": [
                  {
                    "days": 0,
                    "enabled": false
                  }
                ]
              },
              {
                "category": "AzureFirewallNetworkRule",
                "category_group": "",
                "enabled": true,
                "retention_policy": [
                  {
                    "days": 0,
                    "enabled": false
                  }
                ]
              }
            ],
            "log_analytics_destination_type": "AzureDiagnostics",
            "log_analytics_workspace_id": "/subscriptions/09624d5e-dd06-4d7b-9cd9-462e3f5416d0/resourceGroups/rg-hub-logs/providers/Microsoft.OperationalInsights/workspaces/hub-fw-logs",
            "metric": [
              {
                "category": "AllMetrics",
                "enabled": true,
                "retention_policy": [
                  {
                    "days": 0,
                    "enabled": false
                  }
                ]
              }
            ],
            "name": "fw-diagnostics",
            "partner_solution_id": null,
            "storage_account_id": null,
            "target_resource_id": "/subscriptions/09624d5e-dd06-4d7b-9cd9-462e3f5416d0/resourceGroups/hub-vnet-rg-m617/providers/Microsoft.Network/azureFirewalls/hub-fw",
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxODAwMDAwMDAwMDAwLCJkZWxldGUiOjM2MDAwMDAwMDAwMDAsInJlYWQiOjMwMDAwMDAwMDAwMCwidXBkYXRlIjoxODAwMDAwMDAwMDAwfX0=",
          "dependencies": [
            "azurerm_log_analytics_workspace.hub_logs",
            "azurerm_resource_group.rg_logs",
            "data.azurerm_firewall.hub_fw",
            "data.azurerm_resource_group.hub_vnet_rg_m617"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "azurerm_resource_group",
      "name": "hub-vnet-rg",
      "provider": "provider[\"registry.terraform.io/hashicorp/azurerm\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "/subscriptions/09624d5e-dd06-4d7b-9cd9-462e3f5416d0/resourceGroups/hub-vnet-rg-m617",
            "location": "australiaeast",
            "managed_by": "",
            "name": "hub-vnet-rg-m617",
            "tags": {},
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo1NDAwMDAwMDAwMDAwLCJkZWxldGUiOjU0MDAwMDAwMDAwMDAsInJlYWQiOjMwMDAwMDAwMDAwMCwidXBkYXRlIjo1NDAwMDAwMDAwMDAwfSwic2NoZW1hX3ZlcnNpb24iOiIwIn0="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "azurerm_resource_group",
      "name": "rg_logs",
      "provider": "provider[\"registry.terraform.io/hashicorp/azurerm\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "/subscriptions/09624d5e-dd06-4d7b-9cd9-462e3f5416d0/resourceGroups/rg-hub-logs",
            "location": "australiaeast",
            "managed_by": "",
            "name": "rg-hub-logs",
            "tags": {},
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo1NDAwMDAwMDAwMDAwLCJkZWxldGUiOjU0MDAwMDAwMDAwMDAsInJlYWQiOjMwMDAwMDAwMDAwMCwidXBkYXRlIjo1NDAwMDAwMDAwMDAwfX0="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "azurerm_sentinel_alert_rule_scheduled",
      "name": "rdp_spike",
      "provider": "provider[\"registry.terraform.io/hashicorp/azurerm\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "alert_details_override": [],
            "alert_rule_template_guid": "",
            "alert_rule_template_version": "",
            "custom_details": {},
            "description": "",
            "display_name": "High RDP Traffic Detected",
            "enabled": true,
            "entity_mapping": [],
            "event_grouping": [],
            "id": "/subscriptions/09624d5e-dd06-4d7b-9cd9-462e3f5416d0/resourceGroups/rg-hub-logs/providers/Microsoft.OperationalInsights/workspaces/hub-fw-logs/providers/Microsoft.SecurityInsights/alertRules/High RDP Traffic Detected",
            "incident": [
              {
                "create_incident_enabled": true,
                "grouping": [
                  {
                    "by_alert_details": [],
                    "by_custom_details": [],
                    "by_entities": [],
                    "enabled": false,
                    "entity_matching_method": "AllEntities",
                    "lookback_duration": "PT5M",
                    "reopen_closed_incidents": false
                  }
                ]
              }
            ],
            "incident_configuration": [
              {
                "create_incident": true,
                "grouping": [
                  {
                    "enabled": false,
                    "entity_matching_method": "AllEntities",
                    "group_by_alert_details": [],
                    "group_by_custom_details": [],
                    "group_by_entities": [],
                    "lookback_duration": "PT5M",
                    "reopen_closed_incidents": false
                  }
                ]
              }
            ],
            "log_analytics_workspace_id": "/subscriptions/09624d5e-dd06-4d7b-9cd9-462e3f5416d0/resourceGroups/rg-hub-logs/providers/Microsoft.OperationalInsights/workspaces/hub-fw-logs",
            "name": "High RDP Traffic Detected",
            "query": "SecurityEvent\r\n| where EventID == 4625 and AccountType == \"User\"\r\n",
            "query_frequency": "PT1H",
            "query_period": "PT1H",
            "sentinel_entity_mapping": [],
            "severity": "High",
            "suppression_duration": "PT5H",
            "suppression_enabled": false,
            "tactics": [],
            "techniques": [],
            "timeouts": null,
            "trigger_operator": "GreaterThan",
            "trigger_threshold": 5
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxODAwMDAwMDAwMDAwLCJkZWxldGUiOjE4MDAwMDAwMDAwMDAsInJlYWQiOjMwMDAwMDAwMDAwMCwidXBkYXRlIjoxODAwMDAwMDAwMDAwfX0=",
          "dependencies": [
            "azurerm_log_analytics_workspace.hub_logs",
            "azurerm_resource_group.rg_logs",
            "azurerm_sentinel_log_analytics_workspace_onboarding.hub_logs"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "azurerm_sentinel_log_analytics_workspace_onboarding",
      "name": "hub_logs",
      "provider": "provider[\"registry.terraform.io/hashicorp/azurerm\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "customer_managed_key_enabled": false,
            "id": "/subscriptions/09624d5e-dd06-4d7b-9cd9-462e3f5416d0/resourceGroups/rg-hub-logs/providers/Microsoft.OperationalInsights/workspaces/hub-fw-logs/providers/Microsoft.SecurityInsights/onboardingStates/default",
            "resource_group_name": "rg-hub-logs",
            "timeouts": null,
            "workspace_id": "/subscriptions/09624d5e-dd06-4d7b-9cd9-462e3f5416d0/resourceGroups/rg-hub-logs/providers/Microsoft.OperationalInsights/workspaces/hub-fw-logs",
            "workspace_name": "hub-fw-logs"
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxODAwMDAwMDAwMDAwLCJkZWxldGUiOjE4MDAwMDAwMDAwMDAsInJlYWQiOjMwMDAwMDAwMDAwMH19",
          "dependencies": [
            "azurerm_log_analytics_workspace.hub_logs",
            "azurerm_resource_group.rg_logs"
          ]
        }
      ]
    }
  ],
  "check_results": null
}
